{% extends 'DriveX/base.html' %}
{% load static %}

{% block title %}Calcular Ruta Óptima - DriveX{% endblock %}

{% block content %}
<main style="padding-top: 120px; padding-bottom: 3rem;">
    <section class="form-section">
        <div class="container">
            <div class="section-title fade-in">
                <h2>Calcular Ruta Más Corta</h2>
                <p>Selecciona una sucursal de origen y destino para encontrar la ruta óptima entre ellas.</p>
            </div>

            <form method="GET" action="{% url 'calcular_ruta' %}" class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label for="origen">Sucursal de Origen</label>
                        <select name="origen" id="origen" class="form-input" required>
                            <option value="">Selecciona un origen...</option>
                            {% for sucursal in sucursales %}
                                <option value="{{ sucursal.pk }}" {% if sucursal.pk == origen_pk %}selected{% endif %}>{{ sucursal.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="destino">Sucursal de Destino</label>
                        <select name="destino" id="destino" class="form-input" required>
                            <option value="">Selecciona un destino...</option>
                            {% for sucursal in sucursales %}
                                <option value="{{ sucursal.pk }}" {% if sucursal.pk == destino_pk %}selected{% endif %}>{{ sucursal.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 1rem;">
                    <button type="submit" class="cta-button">Calcular Ruta</button>
                </div>
            </form>

            {% if ruta_optima %}
            <div class="results-container" style="margin-top: 3rem; background: var(--secondary-dark); padding: 2rem; border-radius: 15px; text-align: center;">
                <h3 style="color: var(--primary-gold); font-size: 1.8rem; margin-bottom: 1rem;">Ruta Óptima Encontrada</h3>
                {% if distancia != -1 %}
                    <p style="font-size: 1.2rem; margin-bottom: 1rem;">
                        La distancia más corta es de <strong>{{ distancia }} km</strong>.
                    </p>
                    <p style="font-size: 1.2rem;">
                        El camino es: <br>
                        <strong style="color: var(--primary-gold);">{{ ruta_optima|join:' &rarr; ' }}</strong>
                    </p>
                {% else %}
                    <p style="font-size: 1.2rem; color: #ff8a8a;">
                        No se encontró una ruta posible entre las sucursales seleccionadas.
                    </p>
                {% endif %}
            </div>
            {% endif %}

        </div>
    </section>
</main>
{% endblock %}