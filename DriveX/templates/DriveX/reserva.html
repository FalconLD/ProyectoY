{% extends 'DriveX/base.html' %}
{% load static %}

{% block title %}Reservar - Rental Car DriveX{% endblock %}

{% block content %}
<main style="padding-top: 120px; padding-bottom: 3rem;">
    <section class="services">
        <div class="container">
            <div class="section-title fade-in">
                <h2>Reserva tu Experiencia Premium</h2>
                <p>Completa los detalles para personalizar tu servicio de transporte de lujo</p>
            </div>

            <div class="form-container fade-in">
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}

                <form id="reservation-form" method="post" action="{% url 'reserva' %}">
                    {% csrf_token %}

                    <!-- Fila 1: Nombre y Email (dos columnas) -->
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.nombre_completo.label_tag }}
                            {{ form.nombre_completo }}
                            <div class="error-message">{{ form.nombre_completo.errors }}</div>
                        </div>
                        <div class="form-group">
                            {{ form.email.label_tag }}
                            {{ form.email }}
                            <div class="error-message">{{ form.email.errors }}</div>
                        </div>
                    </div>

                    <!-- Fila 2: Teléfono y Vehículo (dos columnas) -->
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.telefono.label_tag }}
                            {{ form.telefono }}
                            <div class="error-message">{{ form.telefono.errors }}</div>
                        </div>
                        <div class="form-group">
                            {{ form.vehiculo.label_tag }}
                            {{ form.vehiculo }}
                            <div class="error-message">{{ form.vehiculo.errors }}</div>
                        </div>
                    </div>

                    <!-- Fila 3: Fecha y Hora (dos columnas) -->
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.fecha_servicio.label_tag }}
                            {{ form.fecha_servicio }}
                            <div class="error-message">{{ form.fecha_servicio.errors }}</div>
                        </div>
                        <div class="form-group">
                            {{ form.hora_servicio.label_tag }}
                            {{ form.hora_servicio }}
                            <div class="error-message">{{ form.hora_servicio.errors }}</div>
                        </div>
                    </div>
                    
                    <!-- Fila 4: Duración y Tipo de Servicio (dos columnas) -->
                     <div class="form-row">
                        <div class="form-group">
                            {{ form.duracion.label_tag }}
                            {{ form.duracion }}
                            <div class="error-message">{{ form.duracion.errors }}</div>
                        </div>
                        <div class="form-group">
                            {{ form.tipo_servicio.label_tag }}
                            {{ form.tipo_servicio }}
                            <div class="error-message">{{ form.tipo_servicio.errors }}</div>
                        </div>
                    </div>

                    <!-- Fila 5: Dirección y Destino (campos anchos) -->
                    <div class="form-group">
                        {{ form.direccion_recogida.label_tag }}
                        {{ form.direccion_recogida }}
                        <div class="error-message">{{ form.direccion_recogida.errors }}</div>
                    </div>
                    <div class="form-group">
                        {{ form.destino.label_tag }}
                        {{ form.destino }}
                        <div class="error-message">{{ form.destino.errors }}</div>
                    </div>
                    
                    <!-- Fila 6: Solicitudes Especiales (campo ancho) -->
                    <div class="form-group">
                        {{ form.solicitudes_especiales.label_tag }}
                        {{ form.solicitudes_especiales }}
                        <div class="error-message">{{ form.solicitudes_especiales.errors }}</div>
                    </div>

                    <div style="text-align: center; margin-top: 2rem;">
                        <button type="submit" class="cta-button">Confirmar Reserva</button>
                    </div>
                </form>
            </div>
        </div>
    </section>
</main>

<!-- Tu script para pre-seleccionar el vehículo -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const urlParams = new URLSearchParams(window.location.search);
        const vehicleParam = urlParams.get('vehicle');
        if (vehicleParam) {
            // El ID que Django genera es id_ + nombre_del_campo
            const vehicleSelect = document.getElementById('id_vehiculo');
            if(vehicleSelect) {
                // Buscamos la opción cuyo valor sea el ID del vehículo, no el slug
                // Esto requiere un pequeño ajuste en la vista para pasar los IDs.
                // Por ahora, asumimos que el valor del <option> es el ID.
                // Esta parte puede requerir ajuste fino.
            }
        }
    });
</script>
{% endblock %}